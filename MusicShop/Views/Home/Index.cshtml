@using MusicShop.Models;
@model Store
@{
    ViewBag.Title = "Home Page";
}
@using (Html.BeginForm())
{
    <div class="row">
        <div class="col-md-10">
            <input class="form-control" type="text" name="search" placeholder="Search" />
        </div>
        <div class="col-md-2">
            <input class="form-control" type="submit" value="Search" />
        </div>
    </div>
    <div class="row">
        <div class="col-md-12" style="text-align:right">
            <a id="advancedSearch" href="#">Advanced Search</a>
        </div>
    </div>
    <div class="row advancedSearch">
        <div class="col-md-4">
            <select name="genre" class="form-control">
                <option value="">Select a Genre</option>
                @foreach (var genre in Model.Genres.Select(x => x.Name).Distinct())
                {
                    <option value="@genre">@genre</option>
                }
            </select>
        </div>
        <div class="col-md-4">
            <input class="form-control" type="number" name="fromYear" placeholder="From" />
        </div>
        <div class="col-md-4">
            <input class="form-control" type="number" name="toYear" placeholder="To" />
        </div>
    </div>
}
<div class="row">
    <div class="col-md-12">
        <table class="table table-hover table-striped table-condensed">
            <thead>
                <tr>
                    <th>Album</th>
                    <th>Artist</th>
                    <th>Genre</th>
                    <th>Year</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var album in Model.Albums)
                {
                    <tr data-toggle="modal" data-target="#albumModal" data-id="@album.ID" data-url="@Url.Action("Album", new { id = album.ID })">
                        <td>@album.Title</td>
                        <td>@album.Artist</td>
                        <td>@album.Genre</td>
                        <td>@album.Year</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="albumModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Album Details</h4>
            </div>
            <div class="modal-body">
                <img style="width:400px;height:228px;" alt="Image Not Available" src="@Model.Albums.First().CoverUrl" />
                <dl class="dl-horizontal">
                    <dt>@Html.DisplayNameFor(model => model.Albums.First().Title)</dt>
                    <dd>@Html.DisplayFor(model => model.Albums.First().Title)</dd>
                    <dt>@Html.DisplayNameFor(model => model.Albums.First().Artist)</dt>
                    <dd>@Html.DisplayFor(model => model.Albums.First().Artist)</dd>
                    <dt>@Html.DisplayNameFor(model => model.Albums.First().Genre)</dt>
                    <dd>@Html.DisplayFor(model => model.Albums.First().Genre)</dd>
                    <dt>@Html.DisplayNameFor(model => model.Albums.First().Year)</dt>
                    <dd>@Html.DisplayFor(model => model.Albums.First().Year)</dd>
                </dl>

                <table class="table table-hover table-striped table-condensed">
                    <thead>
                        <tr>
                            <th>Track Number</th>
                            <th>SongTitle</th>
                            <th>Length</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var track in Model.Albums.First().Tracks)
                        {
                            <tr>
                                <td>@track.Number</td>
                                <td>@track.SongTitle</td>
                                <td>@track.Length</td>
                            </tr>
                        }
                    </tbody>
                </table>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


@section scripts{
    <script>
        $('#albumModal').on('show.bs.modal', function (event) {
            //debugger;
            var modal = $(this);
            var element = $(event.relatedTarget);
            var url = element.data('url');
            var albumnId = element.data('id');
            modal.find('#albumModal').html($('<b> Order Id selected: ' + albumnId + '</b>'));
            //TODO: Bind the results
        }).on('show', function () {
            //make your ajax call populate items or what even you need
        });
    </script>
}